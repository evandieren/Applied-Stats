---
title: "Project 3 - Premier League Home Advantage during COVID"
author: "Eliott Van Dieren"
date: "`r Sys.Date()`"
output: 
  html_document:
    theme: united
    number_sections: true
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(car)
library(knitr)
library(kableExtra)
```

# Introduction



# Data exploration

## Dataset Description


## Dataset transformations


```{r,echo=FALSE,message=FALSE,warning=FALSE}
m_1819 <- read.csv("Premier_League/2018-2019.csv")
m_1920 <- read.csv("Premier_League/2019-2020.csv")
m_2021 <- read.csv("Premier_League/2020-2021.csv")
m_2122 <- read.csv("Premier_League/2021-2022.csv")

m_1819$covid = "before"
m_1920$covid = "before"
m_2021$covid = "in"
m_2122$covid = "later"

kept_variables <- c("HomeTeam","AwayTeam","FTHG","FTAG","covid")

Data <- rbind(m_1819[,kept_variables],m_1920[,kept_variables],
              m_2021[,kept_variables],m_2122[,kept_variables])

AwayData <- Data
AwayData$home = 0
names(AwayData) <- c("opponent","team","opponent_goals","goals","covid", "home")


Data$home = 1
names(Data) <-  c("team","opponent","goals","opponent_goals", "covid", "home")


Data <- rbind(Data,AwayData)

str(Data)

Data <- Data %>% mutate(team=as.factor(team),
                        opponent = as.factor(opponent),
                        covid = as.factor(covid),
                        home = as.factor(home))

str(Data)
```


# Poisson Regression model

In a Poisson Regression setting, one can define the problem as follows : 
$$log(Y_{i,j}) = \beta_1 \cdot H + \beta_2 \cdot C + \beta_3 \cdot H *  C + \beta_4 \cdot T_i + \beta_5 \cdot O_j $$
where $Y_{i,j}$ is the expected number of goals scored by team $T_i$ against opponent team $O_j$, $H$ is a Boolean indicator saying whether the team $T_i$ plays at home, $C$ is the covid indicator, and $H \cdot  C$ marks the interaction between being at Home and playing during Covid.

## Assumptions
In order to apply our model, one has to make some assumptions about the data and what the results will look like:

* We do not make a difference for the coefficients of a given team with respect to each season, therefore Manchester United will have the same coefficient between 2019 and 2022. One more step would be to make another boolean value with respect to the season or check the betting values to evaluate the strength of a given team with respect to the years, but that is out of the scope of this project.
* We assume that the number of goals would follow a Poisson distribution as previously described.

## Model

We can now describe our model :

```r
glm <- glm(goals ~ team + opponent + home + covid + covid:home - 1, data=Data, family=poisson(link="log"))
```

As seen above, we have the response `goals` which is the number of goals scored by `team` during a match against `opponent`. Then, we try to predict this response by using the `team` and `opponent` factor, as well as the `covid` and `home` flag previously described. We also add the interaction between `covid` and `home` which enables us to more precisely describe the link between the home effect and whether the match was played before, during or after covid.

# Did home advantage persist through Covid?

To answer this question, we will answer four subsidiary questions to grasp the home advantage phenomenon a bit better:

* Was there home advantage before Covid?
* Did home advantage reduced during Covid?
* How did it evolved after Covid?
* What are the confidence intervals of those evolutions?

# Conclusion

# Appendix

## Full summary of the final model

